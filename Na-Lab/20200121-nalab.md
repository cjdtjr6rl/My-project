# My Na-Lab Project

<br/>

## <Now Project -> 게시판 생성>

<br/>

### 목차

1. [게시판 추가버튼 활성화](#insert)
2. [게시판 이름 수정](#edit)

--------

- 게시판 추가버튼 활성화<a id="insert"></a>

게시판을 추가하는 페이지의 ui입니다.

![게시판 추가 버튼](https://user-images.githubusercontent.com/43205396/72734220-a24caf80-3bdc-11ea-8532-714bbcdc9db5.png)

<br/>

게시판을 새로 추가하기 위해선 <button value="추가">추가</button>버튼을 눌러줍니다. 추가를 하게되면 새로이 게시판 안에 새로운 게시판이라고 생성이 됩니다. 

![게시판 추가](https://user-images.githubusercontent.com/43205396/72768988-7f51e800-3c3c-11ea-84a5-062294669482.PNG)

<br/>

적용을 하게되면 게시판이 추가가 되는 것을 확인할 수 있습니다.

<br/>

게시판 ui부분 입니다.

```java
<div>
    <div>
        <h6>
            Lab게시판 설정
            <small>기존 생성되어있는 게시판은 변경/삭제가 불가합니다.</small>
        </h6>
    </div>
    <div>
    	<div>게시판</div>
    	<div id="itemBoxWrap">
                                                                <%-- 게시판 리스트 출력 --%>
                                                                <ul id="sortable">
                                                                    <c:forEach items="${selectlabboard}" var="board">
                                                                        <c:if test="${board.board_type eq user_info.board1 || board.board_type eq user_info.board2}">
                                                                            <li class="ui-state-default tooltips b_item" onclick="setTarget('${board.board_num}')" id="${board.board_num}" data-board_title="${board.board_title}" data-delete_division="${board.delete_division}" data-ismain="true" data-flag="${board.flag}" data-isnew="false" data-writeauth="${board.write_auth}" >
                                                                                <span>${board.board_title}</span> &nbsp;
                                                                            </li>
                                                                        </c:if>
                                                                        <c:if test="${board.board_type ne user_info.board1 && board.board_type ne user_info.board2}">
                                                                            <li class="ui-state-default tooltips b_item" onclick="setTarget('${board.board_num}')" id="${board.board_num}" data-board_title="${board.board_title}" data-delete_division="${board.delete_division}" data-ismain="false" data-flag="${board.flag}" data-isnew="false" data-writeauth="${board.write_auth}" >
                                                                                <span>${board.board_title}</span> &nbsp;
                                                                            </li>
                                                                        </c:if>
                                                                    </c:forEach>
                                                                </ul>
                                                                <%-- 게시판 리스트 출력 end--%>
                                                            </div>
    </div>
</div>
<br>
                                                <div class="col-md-6">
                                                    <div class="col-xl-12 col-lg-5">
                                                        <div class="card shadow mb-4">
                                                            <div class="card-header py-3">
                                                                <i class="fa fa-gear"></i> 게시판 정보 (선택 된 게시판)
                                                            </div>
                                                            <div class="panel-body">
                                                                <table class="table">
                                                                    <tr>
                                                                        <td>게시판 이름:</td>
                                                                        <td><input type="text" id="intext" value=""></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>종류</td>
                                                                        <td>
                                                                            <label class="radio"><input type="radio" name="boardType" value="report" id="report" class="boardTypeRadio b_info_view" ><i class="rounded-x"></i>과제</label>&nbsp;
                                                                            <label class="radio"><input type="radio" name="boardType" value="default" id="default" class="boardTypeRadio b_info_view"><i class="rounded-x"></i>일반</label>
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>쓰기권한</td>
                                                                        <td>
                                                                            <label class="radio"><input type="radio" name="writeAuth" value="3" id="writeAuth3" class="b_info_view"><i class="rounded-x"></i>관리자</label>&nbsp;
                                                                            <label class="radio"><input type="radio" name="writeAuth" value="1" id="writeAuth1" class="b_info_view"><i class="rounded-x"></i>모든사용자</label>
                                                                        </td>
                                                                    </tr>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>              
```

<br/>

추가하는 기능의 javascript입니다.

```javascript
// 게시판 추가
function add(){
        target_board_info = {};
        var new_board_code = 'new'+new_board_code_cnt;

    	// 새로운 게시판의 정보를 입력합니다.
        var html = '<li class="ui-state-default tooltips b_item" 											onclick="setTarget(\''+new_board_code+'\')" id="'+new_board_code+'" 					data-board_title="새로운 게시판"><span>새로운 게시판</span></li>';
        $('#sortable').append(html);
        setTarget(new_board_code);
        new_board_code_cnt++;
    }
```

add라는 function을 사용하여 게시판을 새로 추가하고, 게시판 정보를 나타내는 부분에 속성 정보를 가져와 출력합니다.

<br/>

추가한 게시판을 출력하는 기능의 javascript입니다.

```javascript
// 게시판 타겟 설정
function setTarget(id){
        var $target = $('#'+id);
        // 클릭 한 게시판 표시 상태 변경 - 게시판 리스트 중 클릭 상태인 class를 찾아서 클릭 상태 해제 		후 클릭 한 게시판만 클릭 상태 표시
        $('.b_item').each(function(){
            $(this).attr('class','ui-state-default tooltips b_item');
        });
        $target.toggleClass('text-highlights text-highlights-gray');

        // 선택된 게시판의 속성 정보 가져오기
        target_board_info.board_num = id;
        target_board_info.board_title = $target.data("board_title");
        target_board_info.delete_division = $target.data("delete_division");
        target_board_info.writeAuth = $target.data("writeauth");
        target_board_info.isMain = $target.data("ismain");
        target_board_info.isNew = $target.data("isnew");
        target_board_info.flag = $target.data("flag");

        // 게시판 정보 뷰 세팅
        $("#intext").val(target_board_info.board_title);
        $("#"+target_board_info.delete_division).attr('checked',true);
        $("#writeAuth"+target_board_info.writeAuth).attr('checked',true);
        $("#"+target_board_info.delete_division).prop("checked", true);
        $("#writeAuth"+target_board_info.writeAuth).prop('checked',true);

        if(target_board_info.isNew == true){
            $('.boardTypeRadio').attr("disabled",false);
        } else {
            $('.boardTypeRadio').attr("disabled",true);
        }
    }
```

게시판의 타겟을 id로 설정하여 class를 구분을 두어 무슨 게시판을 선택했는지 변경되게 합니다. 그리고 선택한 게시판의 속성 정보를 변수 안에 넣고 그 변수를 출력되는 부분에서 세팅을 진행합니다.<br/>

아래 if문은 기존에 생성되어 있었던 게시판에서 과제 게시판인지, 일반 게시판인지 구분한 것을 수정하지 못하도록 막는 기능입니다.

---------

<br/>

- 게시판 이름 수정<a id="edit"></a>

게시판의 이름을 변경하고 싶은데 게시판의 이름을 수정을 할 때, 구분을 하는 board_num이 배열값으로 들어가 제대로 insert가 되지 않는 현상이 있었습니다.

```javascript
//게시판 이름 변경
    $(document).on('focus','#intext',function(){
        if(target_board_info.board_num === undefined){
            $(this).blur();
        } else {
            $(this).on('keyup', function(){
                var value = $.trim($(this).val());
                var spCheck = /[?&]/g;
                if(spCheck.test(value)) {
                    alert('해당 특수문자는 사용할수 없습니다.');
                    $(this).val(value.replace(/[?&]/g, ""));
                }
                $('#'+target_board_info.board_num).children().text(value);
                $('#'+target_board_info.board_num).data('board_title',value);
            });
        }
    });
```

이와 같이 수정을 하였고, 오류가 날 수 있는 문자 '&'와 '?'는 입력 시 경고창과 함께 replace되게 만들었습니다.

<br/>

ServiceImpl에서 구분을 두었습니다.

```java
@Override
    public void updateRoomBoard(Map<String, Object> map) throws Exception {

        if(map.containsKey("board_num") == false){
            return;
        }

        Map<String,Object> TempMap = new HashMap<String,Object>();
        String roomcode = (String)map.get("roomcode");
        String board_num[] = (String[]) map.get("board_num");
        String board_title[] = (String[])map.get("board_title");
        String write_auth[] = (String[])map.get("write_auth");
        String delete_division[] = (String[])map.get("delete_division");

        if(map.containsKey("del_board_code") == true){
            if(map.get("del_board_code") instanceof String[]){
                String del_board_code[] = (String[])map.get("del_board_code");

                for(int i=0;i<del_board_code.length;i++){

                    TempMap.put("board_num",del_board_code[i]);
                    memberDAO.deleteRoomBoard(TempMap);
                }
            } else if(map.get("del_board_code") instanceof String){
                String del_board_code = (String)map.get("del_board_code");
                TempMap.put("board_num",del_board_code);
                memberDAO.deleteRoomBoard(TempMap);
            }
        }

        for(int i=0;i<board_num.length;i++){

            TempMap.put("roomcode",roomcode);
            TempMap.put("board_num",board_num[i]);
            TempMap.put("board_title",board_title[i]);
            TempMap.put("write_auth",write_auth[i]);
            TempMap.put("delete_division",delete_division[i]);
            TempMap.put("board_order",i+1);

            // board_num에서 new라는 값이 들어가 있을 때와 아닐 때
            if(board_num[i].startsWith("new")){
                memberDAO.insertRoomBoard(TempMap);
            } else {
                memberDAO.updateRoomBoard(TempMap);
            }

        }
    }
```

board_num을 가져와 new(값)이 들어가 있으면 새로 생성한 게시판, 그렇지 않다면 기존에 생성되있던 게시판으로 구분을 두어 새로 생성했을 시에는 insert하고 그렇지 않으면 update를 하게 하였습니다.